<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<title>{{ date | format 'D' | html.escape }}</title>
</head>
<body>
<div class="container">

{{- func repo_link -}}
<a href="{{ url }}/{{ $0.name | html.escape }}">{{ $0.name | html.escape }}</a>
{{- end # func ~}}

{{- func branch_link -}}
<code><a href="{{ url }}/{{ $0.repo_name }}/tree/{{ $0.name | html.escape }}">{{ $0.name | html.escape }}</a></code>
{{- end # func ~}}

{{- func tag_link -}}
<code><a href="{{ url }}/{{ $0.repo_name }}/tree/{{ $0.tag_name | html.escape }}">{{ $0.tag_name | html.escape }}</a></code>
{{- end # func ~}}

{{- func user_link -}}
<a href="{{ url }}/{{ $0 | html.escape }}" class="text-body font-weight-bold">{{ $0 | html.escape }}</a>
{{- end # func ~}}

{{- func commits_text -}}
{{ if $0 == 1 }}commit{{ else }}commits{{ end -}}
{{- end # func ~}}

{{- func commits_link -}}
{{- if $0.commit_count == 1 -}}
<a href="{{ url }}/{{ $0.repo_name }}/commit/{{ $0.after_sha }}">
{{- else -}}
<a href="{{ url }}/{{ $0.repo_name }}/compare/{{ $0.before_sha }}...{{ $0.after_sha }}">
{{- end # if -}}
{{- if $0.commit_count == $0.new_commit_count -}}
{{- $0.new_commit_count }} {{ $0.new_commit_count | commits_text }}</a>
{{- else -}}
{{- $0.commit_count }} {{ $0.commit_count | commits_text }}</a> ({{ $0.new_commit_count }} new)
{{- end # if -}}
{{- end # func ~}}

{{- func commit_link -}}
<a href="{{ url }}/{{ $0.repo_name }}/commit/{{ $0.sha }}"><code>{{ commit.sha | string.slice 0 7 }}</code></a>
{{- end # func ~}}

<h3>{{ date | format 'D' | html.escape }}</h3>

{{ for repo in repos ~}}
<h4>{{ repo | repo_link }} <small class="text-muted">repository</small></h4>

<div class="ml-4">
{{ for branch in repo.branches ~}}
<h5>{{ branch | branch_link }} <small class="text-muted">branch</small></h5>
{{ if !branch.events.empty? ~}}
<ul class="list-unstyled ml-4">
{{ for event in branch.events ~}}
{{ if event.kind == 'push' }}
<li>{{ event.actor_name | user_link }} pushed {{ event | commits_link }}
{{ if !event.new_commits.empty? ~}}
<ul class="list-unstyled ml-4">
{{ for commit in event.new_commits ~}}
<li class="text-truncate">{{ commit | commit_link }} {{ commit.subject }} <span class="text-muted">{{ commit.remarks }}</span></li>
{{ end # for commit ~}}
</ul>
{{ end #if ~}}
</li>
{{ else if event.kind == 'create-branch' }}
<li class="text-truncate">{{ event.actor_name | user_link }} created branch</li>
{{ else if event.kind == 'delete-branch' }}
<li class="text-truncate">{{ event.actor_name | user_link }} deleted branch</li>
{{ end # if event.kind ~}}
{{ end # for event ~}}
</ul>
{{ end # if ~}}
{{ end # for branch ~}}
{{ if !repo.tag_events.empty? ~}}
<h5>tags</h5>
<ul class="list-unstyled ml-4">
{{ for event in repo.tag_events ~}}
{{ if event.kind == 'create-tag' }}
<li class="text-truncate">{{ event.actor_name | user_link }} created tag {{ event | tag_link }}</li>
{{ else if event.kind == 'delete-tag' }}
<li class="text-truncate">{{ event.actor_name | user_link }} deleted tag {{ event | tag_link }}</li>
{{ end # if event.kind ~}}
{{ end # if ~}}
</ul>
{{ end # for event ~}}
</div>

{{ end # for repo ~}}
</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>
