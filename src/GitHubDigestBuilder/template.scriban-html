<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
{{ if auto_refresh ~}}
<meta http-equiv="refresh" content="5">
{{ end # if ~}}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css" />
<title>{{ date | format 'D' | html.escape }}</title>
<style>
nav[data-toggle="toc"] { top: 42px }
a:hover, a:focus { text-decoration: none }
</style>
</head>
<body data-spy="scroll" data-target="#toc">
<div class="container">
<div class="row">
<div class="col-sm-9">

{{- func repo_link -}}
<a href="{{ base_url }}/{{ $0.name | html.escape }}">{{ $0.name | html.escape }}</a>
{{- end # func ~}}

{{- func branch_link -}}
<a href="{{ base_url }}/{{ $0.repo_name }}/tree/{{ $0.name | html.escape }}">
{{- if $0.fork_owner }}{{ $0.fork_owner | html.escape }}:{{ end }}{{ $0.name | html.escape }}</a>
{{- end # func ~}}

{{- func pull_request_link -}}
<a href="{{ base_url }}/{{ $0.repo_name }}/pull/{{ $0.number }}">#{{ $0.number }}</a></code>
{{- end # func ~}}

{{- func tag_link -}}
<code><a href="{{ base_url }}/{{ $0.repo_name }}/tree/{{ $0.tag_name | html.escape }}">{{ $0.tag_name | html.escape }}</a></code>
{{- end # func ~}}

{{- func wiki_link -}}
<code><a href="{{ base_url }}/{{ $0.repo_name }}/wiki/{{ $0.page_name | html.escape }}">{{ $0.page_title | html.escape }}</a></code>
{{- end # func ~}}

{{- func user_link -}}
<a href="{{ base_url }}/{{ $0 | html.escape }}" class="text-body font-weight-bold">{{ $0 | html.escape }}</a>
{{- end # func ~}}

{{- func commits_text -}}
{{ if $0 == 1 }}commit{{ else }}commits{{ end -}}
{{- end # func ~}}

{{- func commits_link -}}
{{- if $0.commit_count == 1 -}}
<a href="{{ base_url }}/{{ $0.repo_name }}/commit/{{ $0.after_sha }}">
{{- else -}}
<a href="{{ base_url }}/{{ $0.repo_name }}/compare/{{ $0.before_sha }}...{{ $0.after_sha }}">
{{- end # if -}}
{{- if $0.commit_count == $0.new_commit_count -}}
{{- $0.new_commit_count }} {{ $0.new_commit_count | commits_text }}</a>
{{- else -}}
{{- $0.commit_count }} {{ $0.commit_count | commits_text }}</a> ({{ $0.new_commit_count }} new)
{{- end # if -}}
{{- end # func ~}}

{{- func commit_link -}}
<a href="{{ base_url }}/{{ $0.repo_name }}/commit/{{ $0.sha }}"><code>{{ commit.sha | string.slice 0 7 }}</code></a>
{{- end # func ~}}

<h3>{{ date | format 'D' | html.escape }}</h3>
<p><a href="./{{ previous_date | format 'yyyy-MM-dd' }}.html">« previous</a> | <a href="./">latest »</a></p>

{{ for repo in repos ~}}
<h4 id="{{ repo.name | string.handleize }}" data-toc-text="{{ repo.name | html.escape }}">{{ repo | repo_link }} <small class="text-muted">repository</small></h4>

<div class="ml-4">

{{ for branch in repo.branches ~}}
{{ if branch.pull_request ~}}
<h5 id="{{ repo.name | string.handleize }}-{{ branch.pull_request.number }}" data-toc-text="PR #{{ branch.pull_request.number }}">{{ branch.pull_request | pull_request_link }} <small class="text-muted">pull request</small></h5>
<p class="ml-4 mb-1 font-italic">{{ branch.pull_request.title | html.escape }}</p>
{{ else ~}}
<h5 id="{{ repo.name | string.handleize }}-{{ branch.name | string.handleize }}" data-toc-text="{{ branch.name | html.escape }}">{{ branch | branch_link }} <small class="text-muted">branch</small></h5>
{{ end # if branch.pull_request ~}}
{{ if !branch.events.empty? ~}}
<ul class="list-unstyled ml-4">
{{ for event in branch.events ~}}
{{ if event.kind == 'push' }}
<li>{{ event.actor_name | user_link }} pushed {{ event | commits_link }}
{{ if !event.new_commits.empty? ~}}
<ul class="list-unstyled ml-4">
{{ for commit in event.new_commits ~}}
<li class="text-truncate">{{ commit | commit_link }} {{ commit.subject }} <span class="text-muted">{{ commit.remarks }}</span></li>
{{ end # for commit ~}}
</ul>
{{ end #if ~}}
</li>
{{ else if event.kind == 'create-branch' ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} created branch</li>
{{ else if event.kind == 'delete-branch' ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} deleted branch</li>
{{ else if event.kind == 'pull-request-opened' ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} opened pull request</li>
{{ else if event.kind == 'pull-request-merged' ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} merged pull request into {{ event.base_branch | branch_link }}</li>
{{ else if event.kind == 'pull-request-closed' ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} closed pull request</li>
{{ else if event.kind == 'pull-request-review-comment-created' ~}}
<li class="text-truncate"><a href="{{ event.conversation.comments[0].url }}"><code>{{ event.conversation.file_path | html.escape }}</code></a>
<ul class="list-unstyled ml-4">
{{ for comment in event.conversation.comments ~}}
<li class="text-truncate">{{ comment.actor_name | user_link }} <a href="{{ comment.url }}" class="text-secondary">&#x21D2;</a> {{ comment.body | html.escape }}</li>
{{ end # for comment ~}}
</ul>
</li>
{{ else ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} <code>{{ event.kind }}</code></li>
{{ end # if event.kind ~}}
{{ end # for event ~}}
</ul>
{{ end # if ~}}
{{ end # for branch ~}}

{{ if !repo.tag_events.empty? ~}}
<h5 id="{{ repo.name | string.handleize }}-tags">tags</h5>
<ul class="list-unstyled ml-4">
{{ for event in repo.tag_events ~}}
{{ if event.kind == 'create-tag' ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} created tag {{ event | tag_link }}</li>
{{ else if event.kind == 'delete-tag' ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} deleted tag {{ event | tag_link }}</li>
{{ else ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} <code>{{ event.kind }}</code></li>
{{ end # if event.kind ~}}
{{ end # for event ~}}
</ul>
{{ end # if ~}}

{{ if !repo.wiki_events.empty? ~}}
<h5 id="{{ repo.name | string.handleize }}-wiki">wiki</h5>
<ul class="list-unstyled ml-4">
{{ for event in repo.wiki_events ~}}
{{ if event.kind == 'created-wiki-page' ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} created {{ event | wiki_link }}</li>
{{ else if event.kind == 'edited-wiki-page' ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} edited {{ event | wiki_link }}</li>
{{ else ~}}
<li class="text-truncate">{{ event.actor_name | user_link }} <code>{{ event.kind }}</code></li>
{{ end # if event.kind ~}}
{{ end # for event ~}}
</ul>
{{ end # if ~}}

{{ if !repo.commented_commits.empty? ~}}
<h5 id="{{ repo.name | string.handleize }}-comments">commit comments</h5>
<ul class="list-unstyled ml-4">
{{ for commit in repo.commented_commits ~}}
<li class="text-truncate">{{ commit | commit_link }}
<ul class="list-unstyled ml-4">
{{ for conversation in commit.conversations ~}}
{{ if conversation.file_path ~}}
<li class="text-truncate"><a href="{{ conversation.comments[0].url }}"><code>{{ conversation.file_path | html.escape }}</code></a>
<ul class="list-unstyled ml-4">
{{ end # if }}
{{ for comment in conversation.comments ~}}
<li class="text-truncate">{{ comment.actor_name | user_link }} <a href="{{ comment.url }}" class="text-secondary">&#x21D2;</a> {{ comment.body | html.escape }}</li>
{{ end # for comment ~}}
{{ if conversation.file_path ~}}
</ul>
</li>
{{ end # if }}
{{ end # for conversation ~}}
</ul>
</li>
{{ end # for commit ~}}
</ul>
{{ end # if ~}}

</div>

{{ end # for repo ~}}
</div>
<div class="col-sm-3">
<nav id="toc" data-toggle="toc" class="sticky-top"></nav>
</div>
</div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<script>
anchors.options.placement = 'left';
anchors.add();
</script>
</body>
</html>
